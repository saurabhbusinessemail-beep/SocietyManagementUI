<app-layout [hideMoreActions]="true" [title]="pageTitle" [showBackButton]="true">
    <form [formGroup]="fb">
        <ui-form-layout>

            <ng-container *ngIf="canAddParking || (canUpdateParking && selectedParkingId)">


                <ui-society-search formControlName="society" [smColumns]="12" [mdColumns]="12" [lgColumns]="12"
                    *ngIf="!society">
                </ui-society-search>

                <ui-label [valueText]="society.societyName" [config]="societyNameConfig" direction="horizontal"
                    valueType="info" [smColumns]="12" [mdColumns]="10" [lgColumns]="10" *ngIf="society">
                </ui-label>

                <section class="ui-form-layout" [smColumns]="12" [mdColumns]="12" [lgColumns]="12" #target>

                    <ui-drop-down formControlName="building" [config]="buildingSelectorConfig"
                        [options]="buildingOptions" placeholder="Select Building" [smColumns]="12" [mdColumns]="6"
                        [lgColumns]="3">
                    </ui-drop-down>


                    <ui-drop-down formControlName="parkingType" [config]="parkingTypeSelectorConfig"
                        [options]="parkingTypeOptions" placeholder="Select Parking Type" [smColumns]="12"
                        [mdColumns]="6" [lgColumns]="3">
                    </ui-drop-down>


                    <ui-drop-down formControlName="flatId" [config]="flatIdConfig" [options]="parkingFlatOptions"
                        placeholder="Select Flat" [smColumns]="12" [mdColumns]="6" [lgColumns]="3">
                    </ui-drop-down>

                    <ui-text-box formControlName="parkingNumber" [config]="parkingNumberConfig" [smColumns]="12"
                        [mdColumns]="6" [lgColumns]="3">
                    </ui-text-box>
                </section>

                <section class="flex flex-end flex-gap" [smColumns]="12" [mdColumns]="12" [lgColumns]="12">

                    <ui-label [valueText]="errorMessage" [config]="{id: 'error'}" *ngIf="errorMessage" valueType="error"
                        [smColumns]="12" [mdColumns]="6" [lgColumns]="6">
                    </ui-label>

                    <ui-button label="Auto Generate" type="only-content" [smColumns]="12" [mdColumns]="2"
                        [lgColumns]="2" (clicked)="generateParking()"
                        *ngIf="!selectedParkingId && selectedBuildingId && (society?.numberOfBuildings ?? 0) > 1">
                    </ui-button>

                    <ui-button label="Cancel" type="only-content" [smColumns]="12" [mdColumns]="2" [lgColumns]="2"
                        *ngIf="selectedParkingId" [disable]="fb.invalid" (clicked)="cancelEditParking()">
                    </ui-button>

                    <ui-button label="Save" [smColumns]="12" [mdColumns]="2" [lgColumns]="2" *ngIf="selectedParkingId"
                        [disable]="fb.invalid" (clicked)="updateParking()">
                    </ui-button>

                    <ui-button label="Add" [smColumns]="12" [mdColumns]="2" [lgColumns]="2" *ngIf="!selectedParkingId"
                        [disable]="fb.invalid" (clicked)="addParking()">
                    </ui-button>
                </section>

            </ng-container>

            <ng-container *ngFor="let parking of parkings">
                <ui-card [smColumns]="12" [mdColumns]="6" [lgColumns]="6" [disable]="selectedParkingId === parking._id">

                    <div card-main class="flex-column">

                        <div class="flex flex-gap">
                            <span class="note">
                                <b>{{ parking.parkingNumber }}</b>
                            </span>
                            <span class="note">
                                {{ getFlatType(parking) }}
                            </span>
                        </div>

                        <div class="note" *ngIf="parking.flatId">
                            Flat {{ getFlatNumber(parking) }}
                        </div>
                    </div>
                    <div card-icon class="flat-action">
                        <app-icon name="edit" color="#a60000" *ngIf="canUpdateParking" (click)="editParking(parking)">
                        </app-icon>
                        <app-icon class="delete" name="delete" color="#a60000" *ngIf="canDeleteParking"
                            (click)="deleteParking(parking)">
                        </app-icon>
                    </div>
                </ui-card>
            </ng-container>

        </ui-form-layout>
    </form>

</app-layout>